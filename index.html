<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Cofit Áõ¥Êí≠ÊäΩÁçé</title>
<style>
body{
    margin:0;
    font-family:"Microsoft JhengHei",sans-serif;
    text-align:center;
    background:linear-gradient(135deg,#3f8f85,#5aa398);
    color:white;
}

h1{
    margin-top:40px;
    font-size:42px;
}

textarea{
    width:80%;
    height:220px;
    margin:20px auto;
    border-radius:15px;
    border:none;
    padding:20px;
    font-size:18px;
    display:block;
    resize:none;
    color:#333;
}

.controls{
    margin:20px;
    font-size:18px;
}

input,select{
    padding:8px 12px;
    border-radius:8px;
    border:none;
    font-size:16px;
    margin-left:5px;
}

button{
    padding:12px 30px;
    border-radius:25px;
    border:none;
    background:white;
    color:#3f8f85;
    font-size:20px;
    cursor:pointer;
    margin-top:15px;
}

.result{
    margin-top:50px;
    font-size:40px;
    font-weight:bold;
    min-height:150px;
}

.winner{
    margin:10px 0;
    font-size:36px;
}

.confetti{
    position:fixed;
    width:10px;
    height:10px;
    top:-10px;
    animation:fall 3s linear forwards;
}

@keyframes fall{
    to{
        transform:translateY(100vh) rotate(720deg);
        opacity:0;
    }
}
</style>
</head>
<body>

<h1>üéâ Cofit Áõ¥Êí≠ÊäΩÁçé üéâ</h1>

<textarea id="chatInput" placeholder="Ë´ãË≤º‰∏ä Google Meet ËÅäÂ§©Á¥ÄÈåÑ"></textarea>

<div class="controls">
    ÊäΩÁçéÂìÅÈ†ÖÔºö
    <input type="text" id="prize" placeholder="Ë´ãËº∏ÂÖ•ÁçéÂìÅÂêçÁ®±">

    ÊäΩÂá∫‰∫∫Êï∏Ôºö
    <select id="count">
        <option value="1">1‰Ωç</option>
        <option value="2">2‰Ωç</option>
        <option value="3">3‰Ωç</option>
        <option value="4">4‰Ωç</option>
        <option value="5">5‰Ωç</option>
    </select>
</div>

<button onclick="draw()">ÈñãÂßãÊäΩÁçé</button>

<div class="result" id="result"></div>

<script>
function extractNames(text){
    const lines = text.split("\n");
    const names = [];
    let lastWasTime = false;

    const timePattern = /(‰∏äÂçà|‰∏ãÂçà)?\d{1,2}:\d{2}/;

    lines.forEach(line=>{
        const clean = line.trim();
        if(clean==="") return;

        if(timePattern.test(clean)){
            lastWasTime = true;
            return;
        }

        if(lastWasTime){
            lastWasTime = false;
            return;
        }

        if(clean.length<=30){
            names.push(clean);
        }
    });

    return [...new Set(names)];
}

function draw(){
    const text = document.getElementById("chatInput").value;
    const prize = document.getElementById("prize").value;
    const count = parseInt(document.getElementById("count").value);
    const resultDiv = document.getElementById("result");

    const names = extractNames(text);

    if(names.length===0){
        alert("Ê≤íÊúâÂÅµÊ∏¨Âà∞ÂêçÂ≠óÔºÅ");
        return;
    }

    const shuffled = names.sort(()=>0.5-Math.random());
    const winners = shuffled.slice(0,count);

    resultDiv.innerHTML = `‚ú® ÊÅ≠Âñú‰ª•‰∏ãÁç≤Âæó ${prize || "ÁçéÂìÅ"} ‚ú®`;

    winners.forEach(name=>{
        resultDiv.innerHTML += `<div class="winner">${name}</div>`;
    });

    confetti();
}

function confetti(){
    for(let i=0;i<120;i++){
        const div = document.createElement("div");
        div.className="confetti";
        div.style.left=Math.random()*100+"vw";
        div.style.background=`hsl(${Math.random()*360},70%,60%)`;
        div.style.animationDuration=2+Math.random()*3+"s";
        document.body.appendChild(div);
        setTimeout(()=>div.remove(),4000);
    }
}
</script>

</body>
</html>
